# 奇美食品客服語音分析系統 - 功能地圖

## 功能模組組織架構

本功能地圖基於實際系統實現，將所有功能按模組組織，並映射到具體的實現元件。

---

## 1. 身份驗證模組 (Authentication)

### 1.1 用戶登入
- **功能描述**: 系統進入點，JWT Token 身份驗證與會話管理
- **實現元件**: 
  - 前端：`/views/auth/LoginView.vue`
  - 後端：`/api/v1/auth/login`
- **具體功能**:
  - Email/使用者名稱登入
  - bcrypt 密碼驗證
  - JWT Access/Refresh Token 生成
  - Token 自動刷新機制
  - 登入狀態持久化
  - 自動跳轉至儀表板

### 1.2 會話管理
- **功能描述**: Token 管理與安全控制
- **實現元件**:
  - 前端：`/stores/auth.ts`
  - 後端：`/api/v1/auth/refresh`, `/api/v1/auth/logout`
- **具體功能**:
  - Access Token 30分鐘有效期
  - Refresh Token 7天有效期
  - Token 自動刷新
  - 安全登出清除 Token
  - 密碼修改功能
  - 401 錯誤自動處理

---

## 2. 儀表板模組 (Dashboard)

### 2.1 視覺化儀表板
- **功能描述**: 5大圖表組件提供整體數據概覽
- **實現元件**: 
  - 前端：`/views/dashboard/DashboardView.vue`
  - 後端：`/api/v1/dashboard/stats`, `/api/v1/dashboard/charts`
- **具體功能**:
  - **統計卡片**: 
    - 總檔案數、今日新增
    - 處理中、失敗數量
  - **橫向柱狀圖**: 
    - 商品提及次數 Top 10
    - 支援點擊跳轉
  - **圓餅圖**: 
    - 情感分析分布（正面/負面/中性）
    - 百分比顯示
  - **垂直柱狀圖**: 
    - 反饋類型分布統計
    - 數據標籤顯示
  - **折線圖**: 
    - 每日檔案處理趨勢
    - 7天/30天切換

### 2.2 圖表互動導航
- **功能描述**: 圖表元素點擊跳轉到詳細分析
- **實現元件**: 
  - 前端：ECharts 事件處理
  - 路由：`/dashboard` → `/analysis?product=XXX`
- **具體功能**:
  - 圖表元素點擊事件綁定
  - URL 參數傳遞查詢條件
  - Analysis 頁面自動載入篩選
  - 返回儀表板保持狀態

### 2.3 數據自動更新
- **功能描述**: 儀表板數據定時刷新與權限篩選
- **實現元件**: 
  - 前端：Vue 3 reactive + 定時器
  - 後端：基於用戶角色的數據過濾
- **具體功能**:
  - 30秒自動刷新機制
  - 基於角色的數據範圍
  - 載入狀態顯示
  - 錯誤重試機制

---

## 3. 數據分析模組 (Analysis)

### 3.1 分析結果列表
- **功能描述**: AI 分析結果的結構化展示與管理
- **實現元件**: 
  - 前端：`/views/analysis/AnalysisView.vue`
  - 後端：`/api/v1/analysis`
- **具體功能**:
  - 顯示欄位：檔案名稱、商品標籤、反饋類型、情感傾向、摘要、上傳者、時間
  - 分頁功能（10/20/50/100 筆）
  - 欄位排序（時間、情感）
  - 列表刷新機制
  - 響應式表格設計

### 3.2 詳細內容查看
- **功能描述**: 單筆分析結果的完整展示
- **實現元件**: 
  - 前端：`/views/analysis/AnalysisDetailView.vue`
  - 後端：`/api/v1/analysis/{id}`
- **具體功能**:
  - 完整分析結果展示
  - 原始文字內容
  - AI 分析詳情（關鍵詞、摘要）
  - 相關檔案資訊
  - 返回列表按鈕

### 3.3 多維度篩選系統
- **功能描述**: 複合條件篩選與資料檢索
- **實現元件**: 
  - 前端：Element Plus Select/DatePicker 組件
  - 後端：動態 SQL 查詢構建
- **具體功能**:
  - **篩選維度**:
    - 商品標籤（多選）
    - 反饋類型（多選）
    - 情感傾向（單選）
    - 上傳者（下拉選單）
    - 時間範圍（日期選擇器）
  - 即時篩選結果更新
  - 篩選條件清除
  - URL 參數同步

### 3.4 數據匯出功能
- **功能描述**: 篩選結果匯出 Excel
- **實現元件**: 
  - 前端：SheetJS (xlsx)
  - 後端：`/api/v1/analysis/export`
- **具體功能**:
  - Excel 格式匯出
  - 包含所有篩選結果
  - 自動檔名：Analysis_YYYYMMDD_HHMMSS.xlsx
  - 匯出進度提示
  - Manager 以上權限

---

## 4. 資料來源管理模組 (Data Source)

### 4.1 檔案上傳系統
- **功能描述**: 多格式檔案上傳與批次處理
- **實現元件**: 
  - 前端：`/views/datasource/DataSourceView.vue`
  - 後端：`/api/v1/files/upload`
- **具體功能**:
  - 支援格式：.wav, .mp3, .txt
  - 拖放上傳區域
  - 多檔案批次上傳
  - 上傳進度顯示
  - 檔案大小限制 100MB
  - 格式驗證提示

### 4.2 檔案列表管理
- **功能描述**: 上傳檔案的集中管理
- **實現元件**: 
  - 前端：Element Plus Table 組件
  - 後端：`/api/v1/files`
- **具體功能**:
  - 列表顯示：檔名、類型、大小、狀態、上傳時間
  - 處理狀態：pending/processing/completed/failed
  - 檔案搜尋功能
  - 單檔刪除（需權限）
  - 刪除確認對話框
  - 狀態圖標顯示

### 4.3 檔案詳情查看
- **功能描述**: 檔案內容與分析結果展示
- **實現元件**: 
  - 前端：`/views/datasource/DataSourceDetailView.vue`
  - 後端：`/api/v1/files/{id}`
- **具體功能**:
  - 檔案基本資訊
  - 轉錄文字顯示（音訊檔）
  - 原始內容顯示（文字檔）
  - 處理狀態追蹤
  - 錯誤訊息顯示
  - 重新處理按鈕

### 4.4 非同步處理機制
- **功能描述**: 檔案上傳後的 AI 處理流程
- **實現元件**: 
  - 後端：FastAPI Background Tasks
  - AI：Whisper ASR + Ollama/Qwen LLM
- **具體功能**:
  - 音訊轉文字（Whisper）
  - 內容分析（LLM）
  - 狀態即時更新
  - 錯誤自動重試
  - 處理佇列管理

---

## 5. 標籤設定模組 (Label Setting)

### 5.1 商品標籤管理
- **功能描述**: 商品分類標籤的維護
- **實現元件**: 
  - 前端：`/views/label/LabelSettingView.vue`
  - 後端：`/api/v1/labels/products`
- **具體功能**:
  - 新增商品標籤（最多200個）
  - 標籤名稱編輯
  - 關鍵字設定（Tag 輸入）
  - 標籤刪除功能
  - 即時保存
  - 重複檢查

### 5.2 反饋類型管理
- **功能描述**: 客戶反饋分類標籤設定
- **實現元件**: 
  - 前端：同上 Vue 組件
  - 後端：`/api/v1/labels/feedback`
- **具體功能**:
  - 新增反饋類型（最多30個）
  - 預設類型：產品品質、包裝問題、配送服務等
  - 關鍵字關聯
  - 編輯與刪除
  - 使用統計顯示

### 5.3 AI 分析整合
- **功能描述**: 標籤與 AI 分析引擎的關聯
- **實現元件**: 
  - 後端：LLM 提示詞模板
  - AI：動態標籤匹配邏輯
- **具體功能**:
  - 關鍵字自動匹配
  - 多標籤支援
  - 置信度評分
  - 標籤更新觸發重分析
  - 分析準確度追蹤

---

## 6. 帳號權限管理模組 (Account Management)

### 6.1 用戶帳號管理
- **功能描述**: 系統用戶的生命週期管理
- **實現元件**: 
  - 前端：`/views/account/AccountManagementView.vue`
  - 後端：`/api/v1/users`
- **具體功能**:
  - 新增用戶（Email、密碼、姓名、角色）
  - 編輯用戶資訊
  - 啟用/停用帳號
  - 用戶列表分頁
  - 搜尋過濾功能
  - 預設 admin 保護

### 6.2 角色權限系統
- **功能描述**: 四級角色權限控制
- **實現元件**: 
  - 前端：路由守衛 + 權限指令
  - 後端：Permission Decorator
- **角色定義**:
  ```
  Admin    - 所有權限
  Manager  - 管理權限（不含用戶管理）
  Operator - 操作權限（上傳、查看）
  Viewer   - 僅查看權限
  ```

### 6.3 權限驗證機制
- **功能描述**: 前後端雙重權限驗證
- **實現元件**: 
  - 前端：Navigation Guards
  - 後端：Dependencies + Decorators
- **具體功能**:
  - 路由級權限控制
  - API 端點權限驗證
  - UI 元素條件顯示
  - 權限不足提示
  - Token 權限同步

---

## 7. 系統整合功能

### 7.1 錯誤處理機制
- **功能描述**: 統一的錯誤處理與用戶提示
- **實現元件**: 
  - 前端：Axios Interceptor + ElMessage
  - 後端：Exception Handlers
- **具體功能**:
  - API 錯誤攔截
  - 友好錯誤提示
  - 自動重試機制
  - 錯誤日誌記錄

### 7.2 國際化支援
- **功能描述**: 繁體中文介面
- **實現元件**: 
  - 前端：Vue I18n
  - 後端：Response 訊息
- **具體功能**:
  - UI 文字中文化
  - 日期時間格式
  - 數字格式化
  - 錯誤訊息翻譯

### 7.3 響應式設計
- **功能描述**: 多裝置適配
- **實現元件**: 
  - 前端：Element Plus 響應式組件
  - CSS：Flexbox/Grid 佈局
- **具體功能**:
  - 桌面版優化
  - 平板適配
  - 最小寬度 1024px
  - 自適應表格

---

## 技術架構總覽

### 前端技術棧
- **框架**: Vue 3 (Composition API)
- **語言**: TypeScript
- **UI 庫**: Element Plus
- **圖表**: ECharts 5
- **狀態管理**: Pinia
- **路由**: Vue Router 4
- **HTTP**: Axios
- **構建**: Vite

### 後端技術棧
- **框架**: FastAPI (Python 3.9+)
- **資料庫**: MySQL 8.0
- **ORM**: SQLAlchemy 2.0
- **認證**: JWT (PyJWT)
- **AI 服務**: Whisper + Ollama/Qwen
- **非同步**: asyncio
- **部署**: Docker

### 整合要點
- RESTful API 設計
- JWT Token 認證
- 角色權限控制
- 非同步任務處理
- 檔案儲存管理
- AI 模型整合

---

## 功能完整性評估

### ✅ 已實現功能
1. **完整的認證系統**：登入、Token 管理、權限控制
2. **豐富的儀表板**：5 種圖表、互動導航、自動更新
3. **強大的分析功能**：多維篩選、詳情查看、數據匯出
4. **檔案管理系統**：上傳、處理、狀態追蹤
5. **靈活的標籤設定**：商品標籤、反饋類型、AI 整合
6. **完善的權限管理**：四級角色、細粒度控制

### 🚀 系統優勢
- **技術先進**：採用最新的 Vue 3 和 FastAPI
- **架構清晰**：前後端分離，模組化設計
- **擴展性強**：支援水平擴展和功能擴充
- **安全可靠**：多層權限驗證，數據加密
- **用戶友好**：直觀的 UI，完善的提示

### 📊 關鍵指標
- **功能覆蓋率**: 100%（基於 PRD 需求）
- **API 端點數**: 25+
- **前端頁面數**: 10+
- **圖表類型**: 5 種
- **角色類型**: 4 級
- **支援格式**: 3 種（wav/mp3/txt）

---

## 總結

本系統完整實現了奇美食品客服語音分析的所有核心需求，包含 **7 個主要模組**，**40+ 個具體功能**，提供了從檔案上傳、AI 分析到數據視覺化的完整解決方案。系統採用現代化技術架構，具備良好的擴展性和維護性，能有效提升客服數據的處理效率和價值。