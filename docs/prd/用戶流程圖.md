# 奇美食品客服語音分析系統 - 用戶流程圖

## 業務場景說明
本流程圖展示了奇美食品客服語音分析系統的核心業務流程，基於實際系統實現，涵蓋用戶從登入到完成主要業務操作的完整路徑。系統支援語音客服數據的上傳、AI分析、標籤管理、數據視覺化和權限管理等核心功能。

## 核心業務流程圖

```mermaid
flowchart TD
    Start([用戶訪問系統]) --> PG001[登入頁面<br/>LoginView.vue]
    
    PG001 --> AuthCheck{JWT Token驗證}
    AuthCheck -->|驗證失敗| PG001
    AuthCheck -->|驗證成功| RoleCheck{用戶角色判斷}
    
    RoleCheck -->|Admin| AdminDashboard[管理員儀表板]
    RoleCheck -->|Manager| ManagerDashboard[主管儀表板]
    RoleCheck -->|Operator| OperatorDashboard[操作員儀表板]
    RoleCheck -->|Viewer| ViewerDashboard[檢視員儀表板]
    
    %% 統一儀表板入口
    AdminDashboard --> PG002[營運洞察儀表板<br/>DashboardView.vue]
    ManagerDashboard --> PG002
    OperatorDashboard --> PG002
    ViewerDashboard --> PG002
    
    %% 儀表板互動流程
    PG002 --> DashboardActions{儀表板操作}
    DashboardActions -->|點擊圖表元素| NavigateToAnalysis[帶參數跳轉]
    DashboardActions -->|查看統計數據| StatsDetail[統計卡片詳情]
    DashboardActions -->|選擇功能模組| MenuNavigation[主選單導航]
    
    NavigateToAnalysis --> PG003[數據分析頁面<br/>AnalysisView.vue]
    StatsDetail --> PG003
    
    %% 主選單導航
    MenuNavigation --> MenuChoice{選擇功能}
    MenuChoice -->|數據分析| PG003
    MenuChoice -->|資料來源| PG005[資料來源管理<br/>DataSourceView.vue]
    MenuChoice -->|分類設定| PG007[分類設定頁面<br/>LabelSettingView.vue]
    MenuChoice -->|帳號管理| PG008[帳號管理頁面<br/>AccountManagementView.vue]
    
    %% 數據分析流程
    PG003 --> AnalysisActions{分析頁面操作}
    AnalysisActions -->|設定篩選條件| FilterData[多維度篩選]
    AnalysisActions -->|查看詳細內容| PG004[分析詳細頁面<br/>AnalysisDetailView.vue]
    AnalysisActions -->|匯出數據| ExportData[Excel匯出]
    
    FilterData --> UpdateResults[更新分析結果]
    UpdateResults --> PG003
    
    PG004 --> DetailActions{詳細頁面操作}
    DetailActions -->|查看原始檔案| PG006[檔案詳細頁面<br/>DataSourceDetailView.vue]
    DetailActions -->|返回列表| PG003
    
    %% 檔案管理流程
    PG005 --> FileActions{檔案管理操作}
    FileActions -->|上傳檔案| UploadFiles[檔案上傳流程]
    FileActions -->|查看檔案詳情| PG006
    FileActions -->|刪除檔案| DeleteConfirm[刪除確認]
    
    UploadFiles --> ProcessFiles[後台AI處理]
    ProcessFiles --> UpdateStatus[更新處理狀態]
    UpdateStatus --> PG005
    
    PG006 --> FileDetailActions{檔案詳情操作}
    FileDetailActions -->|查看轉錄文字| ViewTranscript[顯示ASR結果]
    FileDetailActions -->|查看分析結果| ViewAnalysis[顯示AI分析]
    FileDetailActions -->|重新處理| RetriggerAI[觸發重新分析]
    FileDetailActions -->|返回列表| PG005
    
    %% 標籤設定流程
    PG007 --> LabelActions{標籤管理操作}
    LabelActions -->|管理商品標籤| ProductLabels[商品標籤管理]
    LabelActions -->|管理反饋類型| FeedbackLabels[反饋類型管理]
    
    ProductLabels --> SaveLabels[保存標籤設定]
    FeedbackLabels --> SaveLabels
    SaveLabels --> TriggerReanalysis[觸發重新分析]
    TriggerReanalysis --> PG007
    
    %% 帳號管理流程 (僅Admin)
    PG008 --> AccountActions{帳號管理操作}
    AccountActions -->|新增用戶| CreateUser[創建用戶帳號]
    AccountActions -->|編輯用戶| EditUser[編輯用戶資訊]
    AccountActions -->|設定權限| SetPermissions[角色權限設定]
    AccountActions -->|停用/啟用| ToggleStatus[切換帳號狀態]
    
    CreateUser --> SaveAccount[保存帳號設定]
    EditUser --> SaveAccount
    SetPermissions --> SaveAccount
    ToggleStatus --> SaveAccount
    SaveAccount --> PG008
    
    %% 系統登出
    PG002 --> Logout{登出系統}
    PG003 --> Logout
    PG005 --> Logout
    PG007 --> Logout
    PG008 --> Logout
    Logout --> ClearTokens[清除JWT Token]
    ClearTokens --> PG001
```

## 角色權限流程差異

### Admin (系統管理員) 完整流程
```mermaid
flowchart LR
    A[登入] --> B[儀表板]
    B --> C[數據分析]
    B --> D[檔案管理]
    B --> E[標籤設定]
    B --> F[帳號管理]
    C --> G[匯出報表]
    D --> H[上傳/刪除檔案]
    E --> I[管理所有標籤]
    F --> J[用戶CRUD操作]
```

### Manager (主管) 流程
```mermaid
flowchart LR
    A[登入] --> B[儀表板]
    B --> C[數據分析]
    B --> D[檔案管理]
    B --> E[標籤設定]
    C --> F[匯出報表]
    D --> G[上傳/刪除檔案]
    E --> H[管理所有標籤]
    style F fill:#e1f5fe
    style G fill:#e1f5fe
    style H fill:#e1f5fe
```

### Operator (操作員) 流程
```mermaid
flowchart LR
    A[登入] --> B[儀表板]
    B --> C[數據分析]
    B --> D[檔案管理]
    C --> E[查看分析結果]
    D --> F[上傳檔案]
    style E fill:#fff3e0
    style F fill:#fff3e0
```

### Viewer (檢視員) 流程
```mermaid
flowchart LR
    A[登入] --> B[儀表板]
    B --> C[數據分析]
    C --> D[查看分析結果]
    style D fill:#fce4ec
```

## 關鍵技術流程

### 1. 用戶認證流程
```mermaid
sequenceDiagram
    participant U as 用戶
    participant F as 前端(Vue)
    participant B as 後端(FastAPI)
    participant D as 資料庫

    U->>F: 輸入帳號密碼
    F->>B: POST /api/v1/auth/login
    B->>D: 驗證用戶憑證
    D-->>B: 返回用戶資料
    B-->>F: 返回JWT Tokens
    F->>F: 存儲Token至localStorage
    F-->>U: 跳轉至儀表板
```

### 2. 檔案上傳與AI處理流程
```mermaid
sequenceDiagram
    participant U as 用戶
    participant F as 前端
    participant B as 後端
    participant AI as AI服務
    participant D as 資料庫

    U->>F: 選擇檔案上傳
    F->>B: POST /api/v1/files/upload
    B->>D: 儲存檔案記錄
    B-->>F: 返回上傳成功
    B->>AI: 觸發Background Task
    
    par 音訊檔案處理
        AI->>AI: Whisper ASR轉錄
    and 文字分析
        AI->>AI: Ollama/Qwen分析
    end
    
    AI->>D: 儲存分析結果
    AI-->>B: 更新處理狀態
    B-->>F: WebSocket狀態通知
    F-->>U: 顯示處理完成
```

### 3. 儀表板數據流程
```mermaid
sequenceDiagram
    participant U as 用戶
    participant F as 前端
    participant B as 後端
    participant D as 資料庫

    U->>F: 訪問儀表板
    F->>B: GET /api/v1/dashboard/stats
    F->>B: GET /api/v1/dashboard/charts
    B->>D: 查詢統計數據
    B->>D: 查詢圖表數據
    D-->>B: 返回聚合結果
    B-->>F: 返回JSON數據
    F->>F: ECharts渲染圖表
    F-->>U: 顯示視覺化儀表板
    
    loop 自動刷新
        F->>B: 30秒輪詢更新
        B-->>F: 最新數據
        F->>F: 更新圖表
    end
```

## 業務場景流程

### 場景1：日常客服檔案處理
1. **操作員登入** → 儀表板查看概況
2. **上傳錄音檔** → 批次拖放上傳 .wav/.mp3 檔案
3. **等待AI處理** → 系統自動 ASR + LLM 分析
4. **查看處理結果** → 檢查轉錄準確度與分析結果
5. **標記異常檔案** → 對品質問題檔案標記處理

### 場景2：主管數據分析決策
1. **主管登入** → 儀表板總覽趨勢
2. **深入分析** → 點擊圖表跳轉詳細分析
3. **多維度篩選** → 按商品/時間/情感篩選
4. **發現問題** → 識別負評集中的產品
5. **匯出報表** → 生成Excel報告給相關部門

### 場景3：系統標籤優化
1. **主管登入** → 進入標籤設定頁面
2. **分析現有標籤** → 檢視標籤命中率統計
3. **新增標籤** → 添加新產品或反饋類型
4. **設定關鍵字** → 配置標籤匹配關鍵詞
5. **觸發重分析** → 系統重新分析歷史數據

### 場景4：系統管理員維護
1. **管理員登入** → 查看系統整體狀況
2. **用戶管理** → 新增/編輯用戶帳號
3. **權限設定** → 配置角色權限
4. **系統監控** → 檢查AI服務狀態
5. **數據維護** → 清理過期數據

## 異常處理流程

### 登入失敗處理
- Token過期 → 自動嘗試刷新 → 失敗則跳轉登入頁
- 帳號被停用 → 顯示錯誤訊息 → 聯繫管理員
- 密碼錯誤 → 顯示錯誤提示 → 重新輸入

### 檔案處理失敗
- 格式不支援 → 前端驗證阻擋 → 提示支援格式
- 檔案過大 → 上傳前檢查 → 壓縮或分割建議
- AI處理失敗 → 顯示錯誤狀態 → 提供重試按鈕

### 權限不足處理
- 頁面訪問 → 路由守衛攔截 → 跳轉無權限頁面
- 功能操作 → 按鈕隱藏或禁用 → 提示權限不足
- API調用 → 後端返回403 → 前端顯示錯誤訊息

## 性能優化流程

### 數據載入優化
- 分頁載入：大量數據分批獲取
- 虛擬滾動：表格長列表優化
- 快取機制：頻繁查詢數據快取
- 預載入：預測用戶操作提前載入

### 圖表渲染優化
- 數據聚合：後端預先計算統計數據
- 增量更新：只更新變化的數據點
- 防抖處理：用戶操作防抖避免頻繁請求
- 響應式更新：視窗大小變化自動調整

此用戶流程圖完整展現了系統的實際操作流程，基於真實的代碼實現和業務邏輯，為用戶使用和系統維護提供清晰的指導。